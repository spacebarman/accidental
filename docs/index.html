<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://db.onlinewebfonts.com/c/954a505bdd1fd46577f8b93badf61c8c?family=DIN+Condensed"
      rel="stylesheet"
      type="text/css"
    />
    <title>Accidental</title>
    <style>
      @font-face {
        font-family: 'Rubik';
        src: url('fonts/Rubik-VariableFont_wght.ttf') format('truetype');
        font-weight: 100 900;
      }
      :root {
        --grid-size: 80vmin;
        --brand-size: calc(var(--grid-size) * 0.035);
      }

      html,
      body {
        margin: 0;
        width: 100vw;
        height: 100vh;
        background: #000;
      }

      body {
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "DIN Condensed", sans-serif;
      }

      .player {
        position: relative;
        width: var(--grid-size);
        display: flex;
        flex-direction: column;
      }

      .brand {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding-top: calc(var(--brand-size) * 0.1);
        font-size: var(--brand-size);
        letter-spacing: 0.02em;
        line-height: 1;
        color: #666666;
        text-transform: uppercase;
      }

      .view-toggle {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        margin: 0;
        color: #666666;
        font-family: "DIN Condensed", sans-serif;
        font-size: var(--brand-size);
        letter-spacing: 0.02em;
        line-height: 1;
        transition: color 150ms linear;
        display: flex;
        align-items: center;
      }

      .view-toggle img {
        height: 0.8em;
        width: auto;
        opacity: 0.7;
        transition: opacity 150ms linear;
      }

      .view-toggle:hover img {
        opacity: 1;
      }

      .brand-info {
        position: relative;
        pointer-events: auto;
        cursor: pointer;
      }

      .brand-info::after {
        content: "INFO";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        text-align: right;
        opacity: 0;
      }

      .brand-info:hover {
        color: transparent;
      }

      .brand-info:hover::after {
        opacity: 1;
        color: #bbbbbb;
      }

      .grid {
        width: 100%;
        height: var(--grid-size);
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, 1fr);
      }

      .cell {
        position: relative;
        overflow: hidden;
        transition: opacity 150ms linear;
        filter: brightness(0.7);
      }

      .cell-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        transition: transform 100ms linear;
      }

      .cell:hover {
        opacity: 0.5;
      }

      .cell.active:hover {
        opacity: 1;
      }

      .cell.active {
        filter: brightness(1);
      }

      .cell.active::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        box-shadow: inset 0 0 40px 20px #fff;
        pointer-events: none;
        z-index: 1;
      }

      .cell.next {
        animation: nextPulse 1.6s ease-in-out infinite;
      }

      @keyframes nextPulse {
        0%,
        100% {
          filter: brightness(.3);
        }
        50% {
          filter: brightness(1.2);
        }
      }

      .hidden {
        display: none;
      }

      .progress {
        width: 100%;
        height: 8px;
        background: #3c3c3c;
        opacity: 0;
        transition: opacity 150ms linear;
      }

      .progress.is-visible {
        opacity: 1;
      }

      .progress-fill {
        width: 0%;
        height: 100%;
        background: #adadad;
      }

      a {
        color: #eeeeee;
      }

      .brand a {
        color: #666666;
        text-decoration: none;
      }

      .brand a:hover {
        color: #bbbbbb;
      }

      .info-dialog {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--grid-size);
        background: #222222;
        color: #bbbbbb;
        z-index: 10;
        display: none;
        padding: 3%;
        box-sizing: border-box;
        font-family: 'Rubik', sans-serif;
        font-size: calc(var(--grid-size) * 0.025);
        line-height: 1.6;
      }

      .info-dialog.visible {
        display: block;
      }

      .info-scroll-wrapper {
        width: 100%;
        height: 100%;
        overflow-y: auto;
        padding-right: 2%;
      }

      .info-close {
        position: absolute;
        top: 3%;
        right: 3%;
        margin-right: 2%;
        background: #222222;
        border: 1px solid #666666;
        color: #666666;
        padding: 0.5em 1em;
        cursor: pointer;
        font-family: "DIN Condensed", sans-serif;
        font-size: 1em;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: all 150ms linear;
        z-index: 1;
      }

      .info-close:hover {
        background: #666666;
        color: #000000;
      }

      .cover-view {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--grid-size);
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: none;
        z-index: 5;
        cursor: pointer;
        overflow: hidden;
      }

      .cover-view.visible {
        display: block;
      }

      @media (max-width: 768px) {
        :root {
          --grid-size: 95vmin;
        }

        .info-dialog {
          font-size: calc(var(--grid-size) * 0.03);
        }
      }
    </style>
  </head>
  <body>
    <div class="player">
      <div class="cover-view" id="coverView"></div>
      <div class="grid" id="grid">
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb01.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb02.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb03.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb04.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb05.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb06.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb07.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb08.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb09.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb10.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb11.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb12.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb13.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb14.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb15.jpg')"></div></div>
        <div class="cell"><div class="cell-image" style="background-image: url('images/thumbnails/Spacebarman-Accidents-thumb16.jpg')"></div></div>
      </div>
      <div class="info-dialog" id="infoDialog">
        <button class="info-close" id="infoClose">Close</button>
        <div class="info-scroll-wrapper">
          <div class="info-content">
          <h3>INSTRUCTIONS</h3>
        <p>
          Just click anywhere! Songs will play in random order. Currently playing song will be highlighted, while the next one will blink.
        </p>
        <h3>ABOUT THIS ALBUM</h3>
        <p>
          In a time where everything seems to revolve around chatting with AI machines, this album of small instrumentals is an attempt to convey meaning without words*. Its songs were indeed the result of a conversation, but in this case with a few guitar pedals**. A conversation made of knob positions, footswitch pressing, guitar riffs, listening, and pondering. To align with this wordless dialog, songs don’t have individual names, they are only numbered for the sake of referencing the resulting audio files.
        </p>
        <p>
          The album was recorded through a few meditative sessions between November and October of 2025. In those sessions, I prioritised spontaneity, making an effort to contain my “producer” self to intervene and polish, and instead allowing exploration and surprise to come through. In some cases, however, the explorer in me wanted to add a bit extra structure, and that was ok.
        </p>
        <p>
          Melodies, harmonies or rhythmical patterns were spontaneous responses inspired by accidental noises and sound textures. I captured those textures from multiple sources: unexpected electrical noises***, degraded drones, or loops downtuned beyond recognition. I then acted as an interlocutor, evaluating those abstract sound prompts and replying with musical passages on top, around, or despite them. The result was a bunch of happy accidents.
        </p>
        <p>
          The album is also an appreciation of texture in both sound and visual form.  The artworks are abstract photographs I’ve took in the last few years, macro captures of small worlds or surprising textures from simple everyday things. I hope you enjoy the images as much as the music.
        </p>
        <h3>NOTES</h3>
        <p>
          * Almost. The album has a title, after all. Also this info text is the most I’ve ever written about one of my musical works.<br/>
          ** For the guitar geeks, I used almost exclusively <a href="https://www.chasebliss.com/lost-and-found" target="_blank">ChaseBliss' Lost+Found</a>, <a href="https://empresseffects.com/products/zoia" target="_blank">Empress Effects' Zoia</a> and <a href="https://line6.com/hx-stomp/" target="_blank">Line6 HX Stomp</a>. L+F was my my master texture generator. With the Zoia, I programmed a very interactive stereo looper that allowed me to mangle loops and the live signal separately. I used the HX Stomp only for amp+cab simulation. Oh, I also used <a href="https://banananaeffects.com/products/abracadabra" target="_blank">Banana's Abracadabra</a> in one song. Can you guess which one?<br/>
          *** If I leave my pedalboard alone, it produces some ghostly bell-like sounds at random intervals. They’re beautiful.
        </p>

          </div>
        </div>
      </div>
      <div class="progress" id="progress">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="brand">
        <a href="https://www.spacebarman.com" target="_blank">SPACEBARMAN</a>
        <button class="view-toggle" id="viewToggle">
          <img src="images/icon-cover.svg" alt="Toggle view" width="16" height="16">
        </button>
        <span class="brand-info">ACCIDENTAL</span>
      </div>
    </div>

    <script>
      const playlist = [
        "mp3/Spacebarman-Accidents-Song01.mp3",
        "mp3/Spacebarman-Accidents-Song02.mp3",
        "mp3/Spacebarman-Accidents-Song03.mp3",
        "mp3/Spacebarman-Accidents-Song04.mp3",
        "mp3/Spacebarman-Accidents-Song05.mp3",
        "mp3/Spacebarman-Accidents-Song06.mp3",
        "mp3/Spacebarman-Accidents-Song07.mp3",
        "mp3/Spacebarman-Accidents-Song08.mp3",
        "mp3/Spacebarman-Accidents-Song09.mp3",
        "mp3/Spacebarman-Accidents-Song10.mp3",
        "mp3/Spacebarman-Accidents-Song11.mp3",
        "mp3/Spacebarman-Accidents-Song12.mp3",
        "mp3/Spacebarman-Accidents-Song13.mp3",
        "mp3/Spacebarman-Accidents-Song14.mp3",
        "mp3/Spacebarman-Accidents-Song15.mp3",
        "mp3/Spacebarman-Accidents-Song16.mp3",
      ];

      const audio = new Audio();
      audio.preload = "metadata";

      const cells = Array.from(document.querySelectorAll(".cell"));
      const progress = document.getElementById("progress");
      const progressFill = document.getElementById("progressFill");

      // Cover view functionality - declare early to avoid initialization errors
      const coverView = document.getElementById('coverView');
      const viewToggle = document.getElementById('viewToggle');
      const viewToggleImg = viewToggle.querySelector('img');
      let coverViewActive = false;

      function updateCoverArt(index) {
        const coverPath = `images/coverarts/Spacebarman-Accidents-coverart${(index + 1).toString().padStart(2, '0')}.jpg`;
        coverView.style.backgroundImage = `url('${coverPath}')`;
      }

      function toggleViewMode() {
        coverViewActive = !coverViewActive;
        coverView.classList.toggle('visible');
        viewToggleImg.src = coverViewActive ? 'images/icon-grid.svg' : 'images/icon-cover.svg';
        if (coverViewActive && audio.src) {
          updateCoverArt(activeIndex);
        }
      }

      let hasStarted = false;
      let activeIndex = 0;
      let activeCell = null;
      let nextCell = null;
      let nextIndex = 0;
      let queue = [];
      let queueIndex = 0;

      function generateShuffledQueue(firstIndex) {
        const shuffled = [];
        const remaining = [];
        for (let i = 0; i < playlist.length; i++) {
          if (i !== firstIndex) {
            remaining.push(i);
          }
        }
        for (let i = remaining.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [remaining[i], remaining[j]] = [remaining[j], remaining[i]];
        }
        shuffled.push(firstIndex);
        shuffled.push(...remaining);
        return shuffled;
      }

      function showUi() {
        if (!hasStarted) {
          progress.classList.add("is-visible");
          hasStarted = true;
        }
      }

      function setActiveCell(index) {
        if (activeCell) {
          activeCell.classList.remove("active");
        }

        activeCell = cells[index];
        activeCell.classList.add("active");
      }

      function clearNextCell() {
        if (nextCell) {
          nextCell.classList.remove("next");
          nextCell = null;
        }
      }

      function setNextCell(index) {
        clearNextCell();
        nextIndex = index;
        nextCell = cells[index];
        nextCell.classList.add("next");
      }

      function getRandomNextIndex() {
        if (playlist.length <= 1) {
          return activeIndex;
        }

        let nextIndex = activeIndex;
        while (nextIndex === activeIndex) {
          nextIndex = Math.floor(Math.random() * playlist.length);
        }

        return nextIndex;
      }

      function playTrack(index) {
        if (activeCell) {
          const img = activeCell.querySelector('.cell-image');
          if (img) img.style.transform = 'scale(1) rotate(0deg)';
        }
        queue = generateShuffledQueue(index);
        queueIndex = 0;
        activeIndex = index;
        setActiveCell(index);
        clearNextCell();
        progressFill.style.width = "0%";
        if (activeCell) {
          const img = activeCell.querySelector('.cell-image');
          if (img) img.style.transform = 'scale(1) rotate(0deg)';
        }
        audio.src = playlist[index];
        audio.currentTime = 0;
        audio.play();
        showUi();
        if (queue.length > 1) {
          setNextCell(queue[1]);
        }
        updateCoverArt(index);
      }

      cells.forEach((cell, index) => {
        cell.addEventListener("click", () => {
          if (hasStarted && index === activeIndex) {
            if (audio.paused) {
              audio.play();
            } else {
              audio.pause();
            }
            return;
          }

          playTrack(index);
        });
      });

      audio.addEventListener("timeupdate", () => {
        if (!Number.isFinite(audio.duration) || audio.duration <= 0) {
          progressFill.style.width = "0%";
          return;
        }

        const progressValue = (audio.currentTime / audio.duration) * 100;
        progressFill.style.width = `${progressValue}%`;

        if (activeCell) {
          const scaleValue = 1 + (progressValue * 0.015);
          const rotateValue = (progressValue / 100) * 45;
          const img = activeCell.querySelector('.cell-image');
          if (img) {
            img.style.transform = `scale(${scaleValue}) rotate(${rotateValue}deg)`;
          }
        }
      });

      audio.addEventListener("ended", () => {
        queueIndex++;
        if (queueIndex >= queue.length) {
          queueIndex = 0;
          queue = generateShuffledQueue(queue[0]);
        }
        playTrack(queue[queueIndex]);
      });

      audio.addEventListener("play", () => {
        if (activeCell) {
          activeCell.classList.add("active");
        }
        progress.classList.add("is-visible");
        if (queue.length > queueIndex + 1) {
          setNextCell(queue[queueIndex + 1]);
        }
      });

      audio.addEventListener("pause", () => {
        if (activeCell) {
          activeCell.classList.remove("active");
        }
        progress.classList.remove("is-visible");
        clearNextCell();
      });

      // Initialize with a shuffled queue on page load
      const initialFirstIndex = Math.floor(Math.random() * playlist.length);
      queue = generateShuffledQueue(initialFirstIndex);
      queueIndex = 0;
      if (queue.length > 1) {
        setNextCell(queue[1]);
        updateCoverArt(queue[1]);
      }

      // Info dialog functionality
      const infoDialog = document.getElementById('infoDialog');
      const infoClose = document.getElementById('infoClose');
      const brandInfo = document.querySelector('.brand-info');

      brandInfo.addEventListener('click', () => {
        infoDialog.classList.toggle('visible');
      });

      infoClose.addEventListener('click', () => {
        infoDialog.classList.remove('visible');
      });

      viewToggle.addEventListener('click', toggleViewMode);

      coverView.addEventListener('click', () => {
        if (audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }
      });

      // Keyboard interaction
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          if (!audio.src) {
            playTrack(nextIndex);
          } else if (audio.paused) {
            audio.play();
          } else {
            audio.pause();
          }
        } else if (e.key === 'Escape') {
          infoDialog.classList.remove('visible');
        } else if (e.key === 'i' || e.key === 'I') {
          infoDialog.classList.toggle('visible');
        } else if (e.key === 'c' || e.key === 'C') {
          toggleViewMode();
        } else if (e.key === 'n' || e.key === 'N') {
          queueIndex++;
          if (queueIndex >= queue.length) {
            queueIndex = 0;
            queue = generateShuffledQueue(queue[0]);
          }
          playTrack(queue[queueIndex]);
        }
      });

    </script>
  </body>
</html>
